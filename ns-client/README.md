# ns-client (なにもしないクライアント)

connect後10秒まってclose()するクライアント。
Linuxではソケットレシーブバッファにデータがある状態で
close()するとTCP RSTが送出されるのを検証するためのプログラム。

## 使い方

サーバーはncを使う。
端末上で

```
nc -l 1234
```

別端末で

```
./nc-client 127.0.0.1 1234
```

として放置。
nc端末で適当に入力してエンターキーを押すとデータが
送られる。
その後ns-clientの端末でエンターキーをたたくとソケットレシーブバッファ
にあるデータバイト数を表示しclose()を実行する。
close()時にncサーバーから送られたデータがソケットレシーブバッファに
あり、それをread()していないのでnc-client側からTCP RSTが
送られる。

Linuxパケットキャプチャの図:

```
0.000000 0.000000 IP 127.0.0.1.54854 > 127.0.0.1.1234: Flags [S], seq 4002075201, win 43690, options [mss 65495,sackOK,TS val 3761904582 ecr 0,nop,wscale 7], length 0
0.000037 0.000037 IP 127.0.0.1.1234 > 127.0.0.1.54854: Flags [S.], seq 2369574148, ack 4002075202, win 43690, options [mss 65495,sackOK,TS val 3761904582 ecr 3761904582,nop,wscale 7], length 0
0.000057 0.000020 IP 127.0.0.1.54854 > 127.0.0.1.1234: Flags [.], ack 1, win 342, options [nop,nop,TS val 3761904582 ecr 3761904582], length 0
2.604197 2.604140 IP 127.0.0.1.1234 > 127.0.0.1.54854: Flags [P.], seq 1:7, ack 1, win 342, options [nop,nop,TS val 3761907186 ecr 3761904582], length 6
2.604209 0.000012 IP 127.0.0.1.54854 > 127.0.0.1.1234: Flags [.], ack 7, win 342, options [nop,nop,TS val 3761907186 ecr 3761907186], length 0
10.000249 7.396040 IP 127.0.0.1.54854 > 127.0.0.1.1234: Flags [R.], seq 1, ack 7, win 342, options [nop,nop,TS val 3761914582 ecr 3761907186], length 0
```

OpenBSDではclose()時にソケットレシーブバッファにデータがあっても
TCP RSTは送られない。

```
0.000000 0.000000 127.0.0.1.13189 > 127.0.0.1.1234: S 2110845695:2110845695(0) win 16384 <mss 32728,nop,nop,sackOK,nop,wscale 6,nop,nop,timestamp 1680354762 0> (DF)
0.000018 0.000018 127.0.0.1.1234 > 127.0.0.1.13189: S 3153151623:3153151623(0) ack 2110845696 win 16384 <mss 32728,nop,nop,sackOK,nop,wscale 6,nop,nop,timestamp 4242551535 1680354762> (DF)
0.000030 0.000012 127.0.0.1.13189 > 127.0.0.1.1234: . ack 1 win 256 <nop,nop,timestamp 1680354762 4242551535> (DF)
3.990431 3.990401 127.0.0.1.1234 > 127.0.0.1.13189: P 1:7(6) ack 1 win 256 <nop,nop,timestamp 4242551543 1680354762> (DF)
3.990451 0.000020 127.0.0.1.13189 > 127.0.0.1.1234: . ack 7 win 255 <nop,nop,timestamp 1680354770 4242551543> (DF)
6.477697 2.487246 127.0.0.1.13189 > 127.0.0.1.1234: F 1:1(0) ack 7 win 256 <nop,nop,timestamp 1680354775 4242551543> (DF)
6.477725 0.000028 127.0.0.1.1234 > 127.0.0.1.13189: . ack 2 win 256 <nop,nop,timestamp 4242551548 1680354775> (DF)
6.477864 0.000139 127.0.0.1.1234 > 127.0.0.1.13189: F 7:7(0) ack 2 win 256 <nop,nop,timestamp 4242551548 1680354775> (DF)
6.477903 0.000039 127.0.0.1.13189 > 127.0.0.1.1234: . ack 8 win 256 <nop,nop,timestamp 1680354775 4242551548> (DF)
```
